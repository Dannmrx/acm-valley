<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alta Centro M√©dico - Importar Ponto do Discord</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4cb5f5;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --sidebar-width: 250px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .card h2 {
            color: var(--secondary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #eee;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(76, 181, 245, 0.2);
        }
        
        button {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-discord {
            background: linear-gradient(135deg, #5865F2, #4752c4);
        }
        
        .btn-import {
            background: linear-gradient(135deg, var(--success-color), #1e7e34);
        }
        
        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .registros-container {
            margin-top: 2rem;
        }
        
        .registros-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .registros-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        
        .registros-table th, .registros-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .registros-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        .registros-table tr:last-child td {
            border-bottom: none;
        }
        
        .registro-entrada {
            color: var(--success-color);
        }
        
        .registro-saida {
            color: var(--error-color);
        }
        
        .resumo-horas {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .resumo-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .resumo-card h3 {
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }
        
        .resumo-card .horas-total {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .instructions {
            background-color: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--accent-color);
        }
        
        .instructions h3 {
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }
        
        .instructions ol {
            margin-left: 1.5rem;
        }
        
        .instructions li {
            margin-bottom: 0.5rem;
        }
        
        .discord-message {
            background-color: #36393f;
            color: #dcddde;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .resumo-horas {
                grid-template-columns: 1fr;
            }
            
            .registros-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Importar Ponto do Discord</h1>
            <p>Sistema de importa√ß√£o de registros de ponto do Discord para o site</p>
        </div>
        
        <div id="alertBox" class="alert"></div>
        
        <div class="card">
            <h2>Configura√ß√£o do Importador</h2>
            
            <div class="instructions">
                <h3>Como configurar:</h3>
                <ol>
                    <li>Crie um bot do Discord no <a href="https://discord.com/developers/applications" target="_blank">Portal de Desenvolvedores do Discord</a></li>
                    <li>Adicione o bot ao seu servidor</li>
                    <li>Conceda permiss√µes para o bot ler mensagens no canal de ponto</li>
                    <li>Obtenha o ID do canal de ponto (ative o modo desenvolvedor no Discord, clique com bot√£o direito no canal e "Copiar ID")</li>
                    <li>Insira os dados abaixo e clique em "Conectar ao Discord"</li>
                </ol>
                
                <p>Exemplo de mensagem de ponto no Discord:</p>
                <div class="discord-message">
                    ‚è∞ <strong>Registro de Ponto</strong> - Jo√£o Silva (ACM2023001)<br>
                    üìÖ Data: 25/08/2023<br>
                    üïí Hora: 14:30:45<br>
                    üî∏ Tipo: ENTRADA<br>
                    üë§ Cargo: Enfermeiro
                </div>
            </div>
            
            <div class="form-group">
                <label for="botToken">Token do Bot do Discord</label>
                <input type="password" id="botToken" placeholder="Insira o token do seu bot do Discord">
            </div>
            
            <div class="form-group">
                <label for="channelId">ID do Canal de Ponto</label>
                <input type="text" id="channelId" placeholder="Insira o ID do canal de ponto">
            </div>
            
            <div class="form-group">
                <label for="dataInicio">Data de In√≠cio</label>
                <input type="date" id="dataInicio">
            </div>
            
            <div class="form-group">
                <label for="dataFim">Data de Fim</label>
                <input type="date" id="dataFim">
            </div>
            
            <button id="btnConnect" class="btn-discord">
                <span class="loading-spinner" id="spinnerConnect"></span>
                <i class="fab fa-discord"></i> Conectar ao Discord
            </button>
        </div>
        
        <div class="card" id="resultCard" style="display: none;">
            <h2>Resultado da Importa√ß√£o</h2>
            
            <div class="resumo-horas">
                <div class="resumo-card">
                    <h3>Registros Encontrados</h3>
                    <div class="horas-total" id="totalRegistros">0</div>
                    <p>Total de registros importados</p>
                </div>
                
                <div class="resumo-card">
                    <h3>Horas Totais</h3>
                    <div class="horas-total" id="totalHoras">00:00</div>
                    <p>Total de horas trabalhadas</p>
                </div>
                
                <div class="resumo-card">
                    <h3>Per√≠odo</h3>
                    <div class="horas-total" id="periodo">---</div>
                    <p>Per√≠odo analisado</p>
                </div>
            </div>
            
            <div class="registros-container">
                <div class="registros-header">
                    <h3>Registros Importados</h3>
                    <button id="btnSave" class="btn-import">
                        <i class="fas fa-save"></i> Salvar no Sistema
                    </button>
                </div>
                
                <table class="registros-table">
                    <thead>
                        <tr>
                            <th>Funcion√°rio</th>
                            <th>Data</th>
                            <th>Hora</th>
                            <th>Tipo</th>
                            <th>Cargo</th>
                        </tr>
                    </thead>
                    <tbody id="registrosImportados">
                        <tr>
                            <td colspan="5" style="text-align: center;">Nenhum registro importado</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="card">
            <h2>Registros Salvos no Sistema</h2>
            
            <div class="registros-container">
                <table class="registros-table">
                    <thead>
                        <tr>
                            <th>Funcion√°rio</th>
                            <th>Data</th>
                            <th>Hora</th>
                            <th>Tipo</th>
                            <th>Cargo</th>
                        </tr>
                    </thead>
                    <tbody id="registrosSalvos">
                        <tr>
                            <td colspan="5" style="text-align: center;">Nenhum registro salvo</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos da interface
            const botToken = document.getElementById('botToken');
            const channelId = document.getElementById('channelId');
            const dataInicio = document.getElementById('dataInicio');
            const dataFim = document.getElementById('dataFim');
            const btnConnect = document.getElementById('btnConnect');
            const spinnerConnect = document.getElementById('spinnerConnect');
            const resultCard = document.getElementById('resultCard');
            const totalRegistros = document.getElementById('totalRegistros');
            const totalHoras = document.getElementById('totalHoras');
            const periodo = document.getElementById('periodo');
            const registrosImportados = document.getElementById('registrosImportados');
            const btnSave = document.getElementById('btnSave');
            const registrosSalvos = document.getElementById('registrosSalvos');
            const alertBox = document.getElementById('alertBox');
            
            // Definir datas padr√£o (√∫ltimos 7 dias)
            const hoje = new Date();
            const umaSemanaAtras = new Date();
            umaSemanaAtras.setDate(hoje.getDate() - 7);
            
            dataInicio.value = umaSemanaAtras.toISOString().split('T')[0];
            dataFim.value = hoje.toISOString().split('T')[0];
            
            // Conectar ao Discord e importar registros
            btnConnect.addEventListener('click', async function() {
                if (!botToken.value) {
                    showAlert('Por favor, insira o token do bot do Discord.', 'error');
                    return;
                }
                
                if (!channelId.value) {
                    showAlert('Por favor, insira o ID do canal do Discord.', 'error');
                    return;
                }
                
                // Mostrar loading
                spinnerConnect.style.display = 'inline-block';
                btnConnect.disabled = true;
                
                try {
                    // Simular a importa√ß√£o de registros do Discord
                    // EM UM SISTEMA REAL, aqui voc√™ faria uma requisi√ß√£o para sua API
                    // que se conectaria √† API do Discord para buscar as mensagens
                    
                    await new Promise(resolve => setTimeout(resolve, 2000)); // Simular delay
                    
                    // Gerar alguns registros de exemplo baseados nas datas selecionadas
                    const registros = gerarRegistrosExemplo(dataInicio.value, dataFim.value);
                    
                    // Exibir resultados
                    exibirResultados(registros, dataInicio.value, dataFim.value);
                    
                    // Mostrar card de resultados
                    resultCard.style.display = 'block';
                    
                    showAlert('Registros importados com sucesso do Discord!', 'success');
                    
                } catch (error) {
                    console.error('Erro ao importar do Discord:', error);
                    showAlert('Erro ao conectar com o Discord. Verifique o token e o ID do canal.', 'error');
                } finally {
                    // Esconder loading
                    spinnerConnect.style.display = 'none';
                    btnConnect.disabled = false;
                }
            });
            
            // Salvar registros no sistema
            btnSave.addEventListener('click', function() {
                // Obter registros importados
                const registros = JSON.parse(localStorage.getItem('registrosImportados') || '[]');
                
                if (registros.length === 0) {
                    showAlert('Nenhum registro para salvar.', 'info');
                    return;
                }
                
                // Salvar no localStorage (simulando um banco de dados)
                const registrosExistentes = JSON.parse(localStorage.getItem('registrosPonto') || '[]');
                const novosRegistros = [...registrosExistentes, ...registros];
                
                localStorage.setItem('registrosPonto', JSON.stringify(novosRegistros));
                
                // Atualizar exibi√ß√£o
                exibirRegistrosSalvos();
                
                showAlert('Registros salvos com sucesso no sistema!', 'success');
            });
            
            // Gerar registros de exemplo (simula√ß√£o)
            function gerarRegistrosExemplo(dataInicio, dataFim) {
                const registros = [];
                const inicio = new Date(dataInicio);
                const fim = new Date(dataFim);
                
                // Funcion√°rios de exemplo
                const funcionarios = [
                    { nome: 'Jo√£o Silva', matricula: 'ACM2023001', cargo: 'Enfermeiro' },
                    { nome: 'Maria Santos', matricula: 'ACM2023002', cargo: 'M√©dica' },
                    { nome: 'Pedro Alves', matricula: 'ACM2023003', cargo: 'Recepcionista' }
                ];
                
                // Para cada dia no per√≠odo
                for (let data = new Date(inicio); data <= fim; data.setDate(data.getDate() + 1)) {
                    // Pular finais de semana (apenas exemplo)
                    if (data.getDay() === 0 || data.getDay() === 6) continue;
                    
                    // Para cada funcion√°rio
                    for (const func of funcionarios) {
                        // Gerar hor√°rios de entrada e sa√≠da
                        const horaEntrada = 8 + Math.floor(Math.random() * 2); // Entre 8h e 9h
                        const minutoEntrada = Math.floor(Math.random() * 60);
                        
                        const horaSaida = horaEntrada + 8 + Math.floor(Math.random() * 2); // 8-9 horas depois
                        const minutoSaida = Math.floor(Math.random() * 60);
                        
                        // Registrar entrada
                        registros.push({
                            id: Date.now() + Math.random(),
                            usuario: func.nome,
                            matricula: func.matricula,
                            tipo: 'ENTRADA',
                            timestamp: new Date(data.getFullYear(), data.getMonth(), data.getDate(), horaEntrada, minutoEntrada).toISOString(),
                            data: data.toDateString(),
                            horas: `${horaEntrada.toString().padStart(2, '0')}:${minutoEntrada.toString().padStart(2, '0')}`,
                            cargo: func.cargo
                        });
                        
                        // Registrar sa√≠da
                        registros.push({
                            id: Date.now() + Math.random(),
                            usuario: func.nome,
                            matricula: func.matricula,
                            tipo: 'SAIDA',
                            timestamp: new Date(data.getFullYear(), data.getMonth(), data.getDate(), horaSaida, minutoSaida).toISOString(),
                            data: data.toDateString(),
                            horas: `${horaSaida.toString().padStart(2, '0')}:${minutoSaida.toString().padStart(2, '0')}`,
                            cargo: func.cargo
                        });
                    }
                }
                
                // Ordenar por timestamp
                registros.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                
                // Salvar registros importados no localStorage
                localStorage.setItem('registrosImportados', JSON.stringify(registros));
                
                return registros;
            }
            
            // Exibir resultados da importa√ß√£o
            function exibirResultados(registros, dataInicio, dataFim) {
                // Atualizar contadores
                totalRegistros.textContent = registros.length;
                
                // Calcular horas totais
                const horasTotais = calcularHorasTrabalhadas(registros);
                totalHoras.textContent = formatarHoras(horasTotais);
                
                // Definir per√≠odo
                periodo.textContent = `${formatarData(dataInicio)} √† ${formatarData(dataFim)}`;
                
                // Exibir registros na tabela
                registrosImportados.innerHTML = '';
                
                if (registros.length === 0) {
                    registrosImportados.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum registro encontrado</td></tr>';
                    return;
                }
                
                registros.forEach(registro => {
                    const tr = document.createElement('tr');
                    const data = new Date(registro.timestamp);
                    
                    tr.innerHTML = `
                        <td>${registro.usuario} (${registro.matricula})</td>
                        <td>${data.toLocaleDateString('pt-BR')}</td>
                        <td>${data.toLocaleTimeString('pt-BR')}</td>
                        <td class="${registro.tipo === 'ENTRADA' ? 'registro-entrada' : 'registro-saida'}">
                            ${registro.tipo === 'ENTRADA' ? 'Entrada' : 'Sa√≠da'}
                        </td>
                        <td>${registro.cargo}</td>
                    `;
                    
                    registrosImportados.appendChild(tr);
                });
            }
            
            // Exibir registros salvos
            function exibirRegistrosSalvos() {
                const registros = JSON.parse(localStorage.getItem('registrosPonto') || '[]');
                
                registrosSalvos.innerHTML = '';
                
                if (registros.length === 0) {
                    registrosSalvos.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum registro salvo</td></tr>';
                    return;
                }
                
                // Ordenar por timestamp (mais recente primeiro)
                registros.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                // Limitar a 10 registros mais recentes
                const registrosRecentes = registros.slice(0, 10);
                
                registrosRecentes.forEach(registro => {
                    const tr = document.createElement('tr');
                    const data = new Date(registro.timestamp);
                    
                    tr.innerHTML = `
                        <td>${registro.usuario} (${registro.matricula})</td>
                        <td>${data.toLocaleDateString('pt-BR')}</td>
                        <td>${data.toLocaleTimeString('pt-BR')}</td>
                        <td class="${registro.tipo === 'ENTRADA' ? 'registro-entrada' : 'registro-saida'}">
                            ${registro.tipo === 'ENTRADA' ? 'Entrada' : 'Sa√≠da'}
                        </td>
                        <td>${registro.cargo}</td>
                    `;
                    
                    registrosSalvos.appendChild(tr);
                });
            }
            
            // Calcular horas trabalhadas com base nos registros
            function calcularHorasTrabalhadas(registros) {
                if (registros.length === 0) return 0;
                
                // Ordenar registros por timestamp
                registros.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                
                let totalMinutos = 0;
                let entrada = null;
                
                for (const registro of registros) {
                    if (registro.tipo === 'ENTRADA') {
                        entrada = new Date(registro.timestamp);
                    } else if (registro.tipo === 'SAIDA' && entrada) {
                        const saida = new Date(registro.timestamp);
                        const diffMs = saida - entrada;
                        totalMinutos += diffMs / 1000 / 60;
                        entrada = null;
                    }
                }
                
                return totalMinutos;
            }
            
            // Formatar minutos no formato HH:MM
            function formatarHoras(minutos) {
                const horas = Math.floor(minutos / 60);
                const mins = Math.floor(minutos % 60);
                return `${horas.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
            }
            
            // Formatar data para exibi√ß√£o
            function formatarData(dataString) {
                const data = new Date(dataString);
                return data.toLocaleDateString('pt-BR');
            }
            
            // Mostrar alerta
            function showAlert(message, type) {
                alertBox.textContent = message;
                alertBox.className = 'alert';
                
                if (type === 'success') {
                    alertBox.classList.add('alert-success');
                } else if (type === 'error') {
                    alertBox.classList.add('alert-error');
                } else if (type === 'info') {
                    alertBox.classList.add('alert-info');
                }
                
                alertBox.style.display = 'block';
                
                setTimeout(() => {
                    alertBox.style.display = 'none';
                }, 5000);
            }
            
            // Inicializar a exibi√ß√£o de registros salvos
            exibirRegistrosSalvos();
        });
    </script>
</body>
</html>
