<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ACM - Valley | HP do RP</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
<style>
:root {
    --primary-color: #2c3e50;
    --secondary-color: #3498db;
    --accent-color: #e74c3c;
    --light-color: #ecf0f1;
    --sidebar-width: 250px;
    --sidebar-collapsed-width: 70px;
}

body {
    margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex; min-height: 100vh; background-color: #f8f9fa;
}

/* Sidebar */
.sidebar {
    width: var(--sidebar-width);
    background-color: var(--primary-color);
    color: white; height: 100vh; position: fixed; transition: all 0.3s ease; z-index: 1000;
    box-shadow: 3px 0 10px rgba(0,0,0,0.2);
}
.sidebar.collapsed { width: var(--sidebar-collapsed-width); }
.sidebar-header { padding: 1.5rem 1rem; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1);}
.sidebar-brand { display: flex; align-items: center; justify-content: center; color: white; text-decoration: none; font-weight: bold; font-size: 1.2rem;}
.sidebar-brand i { font-size:1.5rem; margin-right:0.5rem;}
.sidebar.collapsed .sidebar-brand span { display: none;}
.sidebar-menu { list-style: none; padding:0; margin:2rem 0;}
.sidebar-menu li { margin-bottom:0.5rem;}
.sidebar-menu a { color:white; text-decoration:none; display:flex; align-items:center; padding:0.8rem 1rem; transition:0.3s; border-left: 4px solid transparent;}
.sidebar-menu a:hover, .sidebar-menu a.active { background-color: rgba(255,255,255,0.1); border-left-color: var(--secondary-color);}
.sidebar-menu i { margin-right:0.8rem; font-size:1.2rem; width:24px; text-align:center;}
.sidebar.collapsed .sidebar-menu span { display:none;}
.sidebar.collapsed .sidebar-menu i { margin-right:0;}
.toggle-sidebar { position:absolute; bottom:1rem; width:100%; text-align:center;}
.toggle-sidebar-btn { background: rgba(255,255,255,0.1); border:none; color:white; border-radius:50%; width:35px; height:35px; display:flex; align-items:center; justify-content:center; margin:0 auto; cursor:pointer; transition:0.3s;}
.toggle-sidebar-btn:hover { background: rgba(255,255,255,0.2);}

/* Main Content */
.main-content { flex:1; margin-left: var(--sidebar-width); transition:all 0.3s; min-height:100vh; display:flex; flex-direction:column;}
.main-content.expanded { margin-left: var(--sidebar-collapsed-width);}
.topbar { background-color:white; box-shadow:0 2px 5px rgba(0,0,0,0.1); padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center;}
.content { padding:2rem; flex:1;}
.page { display:none;}
.page.active { display:block;}

/* Login / Register */
.login-container { display:flex; width:100%; height:100vh;}
.login-left { flex:1; background:linear-gradient(rgba(44,62,80,0.8),rgba(44,62,80,0.8)), url('https://images.unsplash.com/photo-1532938911079-1b06ac7ceec7?ixlib=rb-4.0.3'); background-size:cover; background-position:center; color:white; display:flex; flex-direction:column; justify-content:center; padding:3rem;}
.login-right { width:400px; background:white; display:flex; flex-direction:column; justify-content:center; padding:2rem; box-shadow:-5px 0 15px rgba(0,0,0,0.1);}

/* Alerts */
.alert-firebase { display:none; position:fixed; top:20px; right:20px; z-index:9999; max-width:400px; }
</style>
</head>
<body>
<div class="alert alert-danger alert-dismissible fade show alert-firebase" role="alert" id="firebase-error">
    <strong>Erro!</strong> <span id="error-message"></span>
    <button type="button" class="btn-close" onclick="dismissError()"></button>
</div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <a href="#" class="sidebar-brand">
            <i class="bi bi-hospital"></i><span>ACM - Valley</span>
        </a>
    </div>
    <ul class="sidebar-menu">
        <li><a href="#" class="active" onclick="showPage('inicio')"><i class="bi bi-house-door"></i><span>Início</span></a></li>
        <li><a href="#" onclick="showPage('exames')"><i class="bi bi-clipboard-check"></i><span>Exames</span></a></li>
        <li><a href="#" onclick="showPage('informes')"><i class="bi bi-megaphone"></i><span>Informes</span></a></li>
        <li><a href="#" onclick="showPage('login')"><i class="bi bi-box-arrow-in-right"></i><span>Login</span></a></li>
    </ul>
    <div class="toggle-sidebar">
        <button class="toggle-sidebar-btn" id="toggle-sidebar"><i class="bi bi-arrow-left-circle"></i></button>
    </div>
</div>

<!-- Main Content -->
<div class="main-content" id="main-content">
    <div class="topbar">
        <h3 id="current-page-title">Início</h3>
        <div id="user-info"><span class="me-3">Bem-vindo, Visitante</span><button class="btn btn-outline-secondary btn-sm" onclick="showPage('login')"><i class="bi bi-box-arrow-in-right"></i> Login</button></div>
    </div>
    <div class="content">
        <!-- Página Inicial -->
        <div id="inicio-page" class="page active">
            <h2>Bem-vindo ao ACM - Valley</h2>
            <p>Hospital de Roleplay de confiança</p>
        </div>

        <!-- Página Login -->
        <div id="login-page" class="page">
            <div class="login-container">
                <div class="login-left"></div>
                <div class="login-right">
                    <h3 class="text-center">Acesso Restrito</h3>
                    <form id="login-form">
                        <div class="mb-3">
                            <label>Email</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-3">
                            <label>Senha</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Entrar</button>
                    </form>
                    <div class="text-center mt-3">
                        <a href="#" onclick="showRegister()">Criar uma conta</a> |
                        <a href="#" onclick="showResetPassword()">Esqueci minha senha</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Página Registro -->
        <div id="register-page" class="page">
            <div class="login-container">
                <div class="login-left"></div>
                <div class="login-right">
                    <h3 class="text-center">Criar Conta</h3>
                    <form id="register-form">
                        <div class="mb-3"><label>Email</label><input type="email" class="form-control" id="register-email" required></div>
                        <div class="mb-3"><label>Senha</label><input type="password" class="form-control" id="register-password" required></div>
                        <div class="mb-3"><label>Confirmar Senha</label><input type="password" class="form-control" id="confirm-password" required></div>
                        <button type="submit" class="btn btn-primary w-100">Criar Conta</button>
                    </form>
                    <div class="text-center mt-3"><a href="#" onclick="showPage('login')">Já tenho uma conta</a></div>
                </div>
            </div>
        </div>

        <!-- Página Admin -->
        <div id="admin-page" class="page">
            <h2>Painel Administrativo</h2>
            <p>Bem-vindo ao painel admin do ACM - Valley.</p>
        </div>
    </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Configuração Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAyrHGWgqxm1Bk0OzoDySIw8vi1vGChLBA",
  authDomain: "acm-valley.firebaseapp.com",
  projectId: "acm-valley",
  storageBucket: "acm-valley.firebasestorage.app",
  messagingSenderId: "825714208536",
  appId: "1:825714208536:web:7872032f7c745b8517386d",
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Sidebar toggle
document.getElementById('toggle-sidebar').addEventListener('click', () => {
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('main-content');
    const icon = document.getElementById('toggle-sidebar').querySelector('i');
    sidebar.classList.toggle('collapsed');
    mainContent.classList.toggle('expanded');
    icon.classList.toggle('bi-arrow-left-circle');
    icon.classList.toggle('bi-arrow-right-circle');
});

// Mostrar página
function showPage(pageId) {
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    const page = document.getElementById(pageId+'-page');
    if(page) page.classList.add('active');
    document.getElementById('current-page-title').textContent = pageId.charAt(0).toUpperCase()+pageId.slice(1);
}

// Mostrar erro
function showError(message) {
    document.getElementById('error-message').textContent = message;
    document.getElementById('firebase-error').style.display = 'block';
}
function dismissError(){ document.getElementById('firebase-error').style.display='none';}

// Login
document.getElementById('login-form').addEventListener('submit', e=>{
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.signInWithEmailAndPassword(email,password)
        .then(userCredential=>{
            const user = userCredential.user;
            db.collection('users').doc(user.uid).get().then(doc=>{
                if(doc.exists && doc.data().role === 'admin') showPage('admin');
                else showPage('inicio');
            });
        })
        .catch(err=>showError(err.message));
});

// Registro
document.getElementById('register-form').addEventListener('submit', e=>{
    e.preventDefault();
    const email = document.getElementById('register-email').value;
    const password = document.getElementById('register-password').value;
    const confirm = document.getElementById('confirm-password').value;
    if(password!==confirm){ showError('Senhas não coincidem!'); return; }
    auth.createUserWithEmailAndPassword(email,password)
        .then(userCredential=>{
            const user = userCredential.user;
            db.collection('users').doc(user.uid).set({role:'user', email:user.email});
            alert('Conta criada! Faça login.');
            showPage('login');
        })
        .catch(err=>showError(err.message));
});

// Recuperar senha
function showResetPassword(){
    const email = prompt('Digite seu email:');
    if(email) auth.sendPasswordResetEmail(email).then(()=>alert('Email enviado!')).catch(err=>showError(err.message));
}

// Monitor auth
auth.onAuthStateChanged(user=>{
    if(user){
        document.getElementById('user-info').innerHTML = `<span class="me-3">Bem-vindo, ${user.email}</span>
        <button class="btn btn-outline-danger btn-sm" onclick="auth.signOut()">Sair</button>`;
    } else {
        document.getElementById('user-info').innerHTML = `<span class="me-3">Bem-vindo, Visitante</span>
        <button class="btn btn-outline-secondary btn-sm" onclick="showPage('login')">Login</button>`;
    }
});
</script>
</body>
</html>
